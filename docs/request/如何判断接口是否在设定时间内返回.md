---
theme: channing-cyan
---
# å‰è¨€

æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦çŸ¥é“æ¥å£æ˜¯å¦åœ¨è®¾å®šæ—¶é—´å†…è¿”å›ã€‚æ¯”å¦‚ï¼Œè¯·æ±‚å‘å‡º30sè¿˜æ²¡è¿”å›å°±å¯ä»¥æç¤ºç”¨æˆ·å½“å‰å µå¡æ˜¯å¦ç»§ç»­æ’é˜Ÿã€‚æ¯”å¦‚ï¼ŒæŸä¸ªè¯·æ±‚æ­£å¸¸æƒ…å†µä¸‹3sè¿”å›ç»“æœï¼Œå¦‚æœç­‰30sæ²¡ç»“æœå°±å¯ä»¥ä¸¢å¼ƒè¿™æ¬¡ç»“æœã€‚æ¯”å¦‚ï¼Œè¶…è¿‡è®¾å®šæ—¶é—´åè‡ªåŠ¨é‡è¯•ã€‚

# axiosè®¾ç½®timeout
```js
import axios from 'axios'; 
// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º10ç§’ 
const timeout = 10000; 
// å‘é€è¯·æ±‚ 
axios.get('https://api.example.com/data', { timeout: timeout }) 
.then(response => { 
    console.log('è¯·æ±‚æˆåŠŸ:', response.data); 
}) 
.catch(error => { 
    if (axios.isCancel(error)) { 
        console.log('è¯·æ±‚å–æ¶ˆ:', error.message); 
    } else if (error.code === 'ECONNABORTED' && error.message.includes('timeout')) {
        console.log('è¯·æ±‚è¶…æ—¶'); 
    } else { 
        console.log('è¯·æ±‚å¤±è´¥:', error); 
    } 
});
```
# vueuseçš„useFetch+timeout
```js
const { data } = useFetch(url, { timeout: 1000 })
```
å¦‚æœåªæ˜¯åœ¨åˆ°è¾¾è®¾å®šæ—¶é—´åè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä¸ä¸¢å¼ƒè¶…æ—¶ç»“æœï¼Œåˆ™å¦‚ä¸‹æ‰€ç¤ºã€‚
```js
const { canAbort } = useFetch(url); 
setTimeout(() => { 
    if (canAbort.value) { 
        // ... 
    } 
}, 1000)
```
# fetch+AbortController
```js
// åˆ›å»ºä¸€ä¸ªAbortControllerå®ä¾‹ 
const controller = new AbortController(); 
// è·å–abortä¿¡å· 
const signal = controller.signal; 
// å‘é€fetchè¯·æ±‚ï¼Œå¹¶å°†signalä¼ é€’ç»™fetché€‰é¡¹ 
fetch(url, { signal }) 
.then(response => { 
    if (!response.ok) { 
        throw new Error('Network response was not ok'); 
    } 
    return response.json(); 
}) 
.then(data => { 
    console.log('è¯·æ±‚æˆåŠŸ:', data); 
}) 
.catch(error => { 
    if (error.name === 'AbortError') { 
        console.log('è¯·æ±‚è¢«å–æ¶ˆ'); 
    } else { 
        console.error('è¯·æ±‚å¤±è´¥:', error); 
    } 
}); 
setTimeout(() => { 
    controller.abort(); 
}, 3000);
```
ğŸ‰ AbortControllerä¸æ”¯æŒIEã€‚

# Promise.race + setTimeout

ğŸ‡ å…ˆå¤ä¹ ä¸€ä¸‹Promise.raceï¼Œæ¥æ”¶ä¸€ä¸ªåŒ…å«å¤šä¸ªpromiseå¯¹è±¡çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œ*åªè¦æœ‰ä¸€ä¸ª*promiseæ”¹å˜çŠ¶æ€ï¼ŒPromise.raceå°±ç«‹åˆ»è¿”å›ã€‚
```js
const timerPromise = new Promise((resolve) => { 
    setTimeout(() => { 
        console.log("timer1"); 
        resolve("timer end"); // è¿™é‡Œä¼šæ‰§è¡Œï¼Œä½†Promise.race().thenæ¥æ”¶ä¸åˆ° 
    }, 10000); 
}); 
const fetchPromise = () => { 
    return fetch().then(response => response.json())
    .then(res => { 
        if (res.code !== 200) { 
            // æ¥å£é”™è¯¯å¤„ç† 
            return new Promise(() => { }); 
        } 
        return res; 
     }); 
 }) 
 Promise.race([timerPromise, fetchPromise]).then((res) => { 
     console.log(res); 
     if (res === 'timeout') { 
         // å¤„ç†è¶…æ—¶åé€»è¾‘ 
         return new Promise(() => { }); 
     } 
     return res; 
});
```
æ‰“å°ç»“æœï¼š  
start fetch  
get fetch res   
timer1

å¦å¤–ï¼Œéœ€è¦æ³¨æ„ï¼ŒfetchPromise.thenæ˜¯å…ˆäºPromise.race().thenæ‰§è¡Œçš„ã€‚

è¿™ç§æ–¹æ¡ˆå¯ä»¥å®ç°åœ¨è¶…æ—¶çš„æ—¶å€™è¿›è¡Œä¸€äº›æ“ä½œï¼Œè€Œä¸ä¸€å®šæŠ›å¼ƒè¯·æ±‚ç»“æœã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç å°±å¯ä»¥åœ¨è¶…æ—¶ä¹‹åè¿›è¡Œä¸€äº›æ“ä½œã€‚
```js
const timerPromise = new Promise((resolve) => { 
    setTimeout(() => { 
        console.log("timer1"); 
        resolve("timer end"); 
    }, 10000); 
}); 
const fetchPromise = () => { 
    return fetch().then(response => response.json()).then(res => { 
        if (res.code !== 200) { 
            return new Promise(() => { }); 
        } 
        // !!! åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›æ“ä½œï¼Œå°±ç®—å…ˆè®¡æ—¶ç»“æŸï¼Œè¿™é‡Œä¹Ÿä¼šæ‰§è¡Œã€‚æ¯”å¦‚è®¾ç½®ä¸€äº›å…¨å±€å˜é‡ç­‰ã€‚                     console.log('after timeout'); 
        return res; 
    }); 
}) 
Promise.race([timerPromise, fetchPromise]).then((res) => { 
    console.log(res); 
    if (res === 'timeout') { 
        // å¤„ç†è¶…æ—¶åé€»è¾‘ 
        return new Promise(() => { }); 
    } 
    return res; 
});
```